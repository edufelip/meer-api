openapi: 3.0.3
info:
  title: Meer API
  version: 0.1.0
  description: REST API for the Meer app (mobile). Uses JWT bearer auth.
servers:
  - url: http://localhost:8080
security:
  - bearerAuth: []
paths:
  /auth/login:
    post:
      summary: Email/password login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Tokens and user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /dashboard/login:
    post:
      summary: Admin-only login for dashboard
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Tokens and user (role will be ADMIN)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /dashboard/users/{id}:
    get:
      summary: Get a user by id (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200':
          description: User
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Profile'
  /dashboard/support/contacts:
    get:
      summary: List contact messages (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema: { type: integer, default: 0 }
        - in: query
          name: pageSize
          schema: { type: integer, default: 20 }
      responses:
        '200':
          description: Paged contact messages
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseSupportContact'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /dashboard/support/contacts/{id}:
    get:
      summary: Get contact message by id (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Contact message
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SupportContact'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: Not found

  /dashboard/categories:
    get:
      summary: List categories (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema: { type: integer, default: 0 }
        - in: query
          name: pageSize
          schema: { type: integer, default: 50 }
      responses:
        '200':
          description: Paged categories
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseCategory'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      summary: Create category (admin)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CategoryUpsertRequest'
      responses:
        '200':
          description: Created category
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          description: Category already exists

  /dashboard/categories/{id}:
    put:
      summary: Update category (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CategoryUpsertRequest'
      responses:
        '200':
          description: Updated category
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: Not found
    delete:
      summary: Delete category (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '204':
          description: Deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: Not found
    delete:
      summary: Delete contact message (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '204':
          description: Deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: Not found

  /stores/{id}:
    get:
      summary: Get store detail
      description: Public endpoint; provide Authorization for personalized fields, invalid tokens return 401.
      security: []
      parameters:
        - $ref: '#/components/parameters/XAppPackageHeader'
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200':
          description: Store detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ThriftStore'
        '404':
          description: Not found
    put:
      summary: Update store (owner or admin)
      description: Social fields accept explicit nulls to clear existing values.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StoreUpdateRequest'
      responses:
        '200':
          description: Updated store
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ThriftStore'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: Not found
    delete:
      summary: Delete store (owner or admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        '204':
          description: Deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: Not found
  /auth/signup:
    post:
      summary: Sign up with email/password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignupRequest'
      responses:
        '201':
          description: Created; returns tokens and user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '409':
          description: Email already registered
  /auth/refresh:
    post:
      summary: Refresh tokens
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshRequest'
      responses:
        '200':
          description: New access/refresh tokens
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /auth/google:
    post:
      summary: Google login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GoogleLoginRequest'
      responses:
        '200':
          description: Tokens and user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
  /auth/apple:
    post:
      summary: Apple login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AppleLoginRequest'
      responses:
        '200':
          description: Tokens and user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
  /auth/me:
    get:
      summary: Current user (profile shape)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Current user profile
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/Profile'
  /profile:
    get:
      summary: Get profile
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Profile'
  /stores:
    get:
      summary: List stores (paged)
      description: Public endpoint; provide Authorization for personalized fields, invalid tokens return 401.
      security: []
      parameters:
        - $ref: '#/components/parameters/XAppPackageHeader'
        - in: query
          name: type
          schema: { type: string, enum: [nearby] }
        - in: query
          name: categoryId
          schema: { type: string }
        - in: query
          name: page
          schema: { type: integer, default: 1 }
        - in: query
          name: pageSize
          schema: { type: integer, default: 10 }
        - in: query
          name: q
          schema: { type: string }
        - in: query
          name: lat
          schema: { type: number, format: double }
        - in: query
          name: lng
          schema: { type: number, format: double }
      responses:
        '200':
          description: Paged stores
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseStoreCard'
    post:
      summary: Create store
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StoreCreateRequest'
      responses:
        '201':
          description: Created store
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ThriftStore'
        '400':
          description: Validation error
        '401':
          $ref: '#/components/responses/Unauthorized'
  /home:
    get:
      summary: Home payload (featured + nearby + guide content)
      description: Public endpoint; provide Authorization for likedByMe, invalid tokens return 401.
      security: []
      parameters:
        - $ref: '#/components/parameters/XAppPackageHeader'
        - in: query
          name: lat
          schema: { type: number, format: double }
          required: true
        - in: query
          name: lng
          schema: { type: number, format: double }
          required: true
      responses:
        '200':
          description: Home payload
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HomeResponse'
  /featured:
    get:
      summary: Top featured stores (lightweight)
      description: Public endpoint; provide Authorization for personalized fields, invalid tokens return 401.
      security: []
      parameters:
        - $ref: '#/components/parameters/XAppPackageHeader'
      responses:
        '200':
          description: Featured stores
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FeaturedStore'
  /nearby:
    get:
      summary: Nearby stores (paginated, light fields)
      description: Public endpoint; provide Authorization for personalized fields, invalid tokens return 401.
      security: []
      parameters:
        - $ref: '#/components/parameters/XAppPackageHeader'
        - in: query
          name: lat
          required: true
          schema: { type: number, format: double }
        - in: query
          name: lng
          required: true
          schema: { type: number, format: double }
        - in: query
          name: pageIndex
          schema: { type: integer, default: 0 }
        - in: query
          name: pageSize
          schema: { type: integer, default: 10 }
      responses:
        '200':
          description: Nearby stores page
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NearbyPage'
  /contents:
    get:
      summary: List guide contents
      description: Public endpoint; provide Authorization for likedByMe, invalid tokens return 401.
      security: []
      parameters:
        - $ref: '#/components/parameters/XAppPackageHeader'
        - in: query
          name: page
          schema: { type: integer, default: 0 }
        - in: query
          name: pageSize
          schema: { type: integer, default: 20 }
        - in: query
          name: q
          schema: { type: string }
        - in: query
          name: sort
          schema:
            type: string
            enum: [newest, oldest]
            default: newest
        - in: query
          name: storeId
          required: false
          schema: { type: string, format: uuid }
      responses:
        '200':
          description: Paged guide content
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseGuideTop'
    post:
      summary: Create guide content
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContentCreateRequest'
      responses:
        '200':
          description: Created content
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GuideTop'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: Store not found

  /contents/{id}:
    get:
      summary: Get content by id
      description: Public endpoint; provide Authorization for likedByMe, invalid tokens return 401.
      security: []
      parameters:
        - $ref: '#/components/parameters/XAppPackageHeader'
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Content detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GuideTop'
        '404':
          description: Not found
    put:
      summary: Update content
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GuideContentUpdateRequest'
      responses:
        '200':
          description: Updated content
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GuideTop'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: Not found
    delete:
      summary: Delete content
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '204':
          description: Deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: Not found

  /contents/{id}/image/upload:
    post:
      summary: Get presigned upload slot for content cover
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Upload slot
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /contents/{id}/likes:
    post:
      summary: Like content
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '204':
          description: Liked
        '401':
          $ref: '#/components/responses/Unauthorized'
    delete:
      summary: Unlike content
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '204':
          description: Unliked
        '401':
          $ref: '#/components/responses/Unauthorized'

  /contents/{id}/comments:
    get:
      summary: List comments for content
      description: Public endpoint; provide Authorization for personalization, invalid tokens return 401.
      security: []
      parameters:
        - $ref: '#/components/parameters/XAppPackageHeader'
        - in: path
          name: id
          required: true
          schema: { type: integer }
        - in: query
          name: page
          schema: { type: integer, default: 0 }
        - in: query
          name: pageSize
          schema: { type: integer, default: 20 }
      responses:
        '200':
          description: Paged comments
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseGuideContentComment'
        '404':
          description: Content not found
    post:
      summary: Create comment
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GuideContentCommentRequest'
      responses:
        '200':
          description: Created comment
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GuideContentComment'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: Content not found

  /contents/{id}/comments/{commentId}:
    patch:
      summary: Edit comment
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
        - in: path
          name: commentId
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GuideContentCommentRequest'
      responses:
        '200':
          description: Updated comment
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GuideContentComment'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: Comment not found
    delete:
      summary: Delete comment
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
        - in: path
          name: commentId
          required: true
          schema: { type: integer }
      responses:
        '204':
          description: Deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: Comment not found

  /dashboard/stores:
    get:
      summary: Admin stores list
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema: { type: integer, default: 0 }
        - in: query
          name: pageSize
          schema: { type: integer, default: 20 }
        - in: query
          name: search
          schema: { type: string }
          description: Case-insensitive search across store name, tagline, description, neighborhood
        - in: query
          name: sort
          schema:
            type: string
            enum: [newest, oldest]
            default: newest
      responses:
        '200':
          description: Paged stores (admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseDashboardStoreSummary'

  /dashboard/contents:
    get:
      summary: Admin contents list
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema: { type: integer, default: 0 }
        - in: query
          name: pageSize
          schema: { type: integer, default: 20 }
        - in: query
          name: q
          schema: { type: string }
        - in: query
          name: sort
          schema:
            type: string
            enum: [newest, oldest]
            default: newest
      responses:
        '200':
          description: Paged contents (admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseGuideTop'

  /dashboard/contents/{id}:
    get:
      summary: Admin content detail
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Content detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GuideTop'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    delete:
      summary: Delete content (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '204':
          description: Deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /dashboard/contents/{id}/restore:
    post:
      summary: Restore content (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Restored content
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GuideTop'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /dashboard/contents/{id}/comments:
    get:
      summary: Admin content comments list
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
        - in: query
          name: page
          schema: { type: integer, default: 0 }
        - in: query
          name: pageSize
          schema: { type: integer, default: 20 }
      responses:
        '200':
          description: Paged comments
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseContentComment'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /dashboard/contents/{id}/comments/{commentId}:
    delete:
      summary: Delete content comment (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
        - in: path
          name: commentId
          required: true
          schema: { type: integer }
      responses:
        '204':
          description: Deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /dashboard/comments:
    get:
      summary: Admin comments queue
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema: { type: integer, default: 0 }
        - in: query
          name: pageSize
          schema: { type: integer, default: 20 }
        - in: query
          name: sort
          schema:
            type: string
            enum: [newest, oldest]
            default: newest
        - in: query
          name: search
          schema: { type: string }
        - in: query
          name: contentId
          schema: { type: integer }
        - in: query
          name: storeId
          schema: { type: string, format: uuid }
        - in: query
          name: from
          schema: { type: string, format: date }
        - in: query
          name: to
          schema: { type: string, format: date }
      responses:
        '200':
          description: Paged comments
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseContentComment'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /dashboard/users:
    get:
      summary: Admin users list
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema: { type: integer, default: 0 }
        - in: query
          name: pageSize
          schema: { type: integer, default: 20 }
        - in: query
          name: q
          schema: { type: string }
        - in: query
          name: sort
          schema:
            type: string
            enum: [newest, oldest]
            default: newest
      responses:
        '200':
          description: Paged users (admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseAdminUser'
  /categories:
    get:
      summary: List categories
      description: Public endpoint; invalid tokens return 401.
      security: []
      parameters:
        - $ref: '#/components/parameters/XAppPackageHeader'
      responses:
        '200':
          description: Categories
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'
  /categories/{categoryId}/stores:
    get:
      summary: Stores by category (paged)
      description: Public endpoint; invalid tokens return 401.
      security: []
      parameters:
        - $ref: '#/components/parameters/XAppPackageHeader'
        - in: path
          name: categoryId
          required: true
          schema: { type: string }
        - in: query
          name: page
          schema: { type: integer, default: 1 }
        - in: query
          name: pageSize
          schema: { type: integer, default: 10 }
      responses:
        '200':
          description: Page of stores
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseStoreCard'
  /favorites:
    get:
      summary: List favorites (lightweight)
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: lat
          schema: { type: number, format: double }
        - in: query
          name: lng
          schema: { type: number, format: double }
      responses:
        '200':
          description: Favorite stores
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FavoriteStore'
  /favorites/{storeId}:
    post:
      summary: Add favorite
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: storeId
          required: true
          schema: { type: string, format: uuid }
      responses:
        '204':
          description: Added
    delete:
      summary: Remove favorite
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: storeId
          required: true
          schema: { type: string, format: uuid }
      responses:
        '204':
          description: Removed
  /push-tokens:
    post:
      summary: Upsert device push token
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PushTokenRequest'
      responses:
        '204':
          description: Upserted
        '400':
          description: Invalid request
        '401':
          $ref: '#/components/responses/Unauthorized'
  /push-tokens/{deviceId}:
    delete:
      summary: Remove device push token
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: deviceId
          required: true
          schema: { type: string }
        - in: query
          name: environment
          required: false
          schema: { type: string, enum: [DEV, STAGING, PROD] }
      responses:
        '204':
          description: Removed
        '400':
          description: Invalid request
        '401':
          $ref: '#/components/responses/Unauthorized'
  /dashboard/push:
    post:
      summary: Send push to a device token (admin)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PushTestRequest'
      responses:
        '200':
          description: Message sent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PushMessageIdResponse'
        '400':
          description: Invalid request
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /dashboard/push/user:
    post:
      summary: Send push to all devices for a user (admin)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PushUserNotificationRequest'
      responses:
        '200':
          description: Sent count
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PushSentCountResponse'
        '400':
          description: Invalid request
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /dashboard/push/broadcast:
    post:
      summary: Broadcast to topic by audience (admin)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PushBroadcastRequest'
      responses:
        '200':
          description: Message sent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PushMessageIdResponse'
        '400':
          description: Invalid request
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  parameters:
    XAppPackageHeader:
      name: X-App-Package
      in: header
      required: true
      schema:
        type: string
      description: Required for public GET endpoints (anonymous mode).
  responses:
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
  schemas:
    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email: { type: string, format: email }
        password: { type: string, format: password }
    SignupRequest:
      type: object
      required: [name, email, password]
      properties:
        name: { type: string }
        email: { type: string, format: email }
        password: { type: string, format: password }
    RefreshRequest:
      type: object
      required: [refreshToken]
      properties:
        refreshToken: { type: string }
    GoogleLoginRequest:
      type: object
      required: [idToken]
      properties:
        idToken: { type: string }
        client: { type: string }
    AppleLoginRequest:
      type: object
      required: [idToken, authorizationCode, provider, client]
      properties:
        idToken: { type: string }
        authorizationCode: { type: string }
        provider: { type: string, example: apple }
        client: { type: string }
    PushTokenRequest:
      type: object
      required: [deviceId, fcmToken, platform, environment]
      properties:
        deviceId: { type: string }
        fcmToken: { type: string }
        platform: { type: string, enum: [ANDROID, IOS] }
        appVersion: { type: string }
        environment: { type: string, enum: [DEV, STAGING, PROD] }
    PushTestRequest:
      type: object
      required: [token, title, body, type, id]
      properties:
        token: { type: string }
        title: { type: string }
        body: { type: string }
        type: { type: string, enum: [guide_content, store] }
        id: { type: string }
    PushUserNotificationRequest:
      type: object
      required: [userId, environment, title, body, type, id]
      properties:
        userId: { type: string, format: uuid }
        environment: { type: string, enum: [DEV, STAGING, PROD] }
        title: { type: string }
        body: { type: string }
        type: { type: string, enum: [guide_content, store] }
        id: { type: string }
    PushBroadcastRequest:
      type: object
      required: [environment, audience, title, body, type, id]
      properties:
        environment: { type: string, enum: [DEV, STAGING, PROD] }
        audience: { type: string, enum: [promos, new_stores] }
        title: { type: string }
        body: { type: string }
        type: { type: string, enum: [guide_content, store] }
        id: { type: string }
    AuthResponse:
      type: object
      properties:
        token: { type: string }
        refreshToken: { type: string }
        user:
          $ref: '#/components/schemas/Profile'
    PushMessageIdResponse:
      type: object
      properties:
        messageId: { type: string }
    PushSentCountResponse:
      type: object
      properties:
        sent: { type: integer }
    Profile:
      type: object
      properties:
        id: { type: integer }
        name: { type: string }
        email: { type: string, format: email }
        role: { type: string, enum: [USER, ADMIN] }
        avatarUrl: { type: string }
        bio: { type: string }
        notifyNewStores: { type: boolean }
        notifyPromos: { type: boolean }
        ownedThriftStore:
          $ref: '#/components/schemas/ThriftStore'
        createdAt: { type: string, format: date-time }
    StoreImage:
      type: object
      properties:
        id: { type: integer }
        url: { type: string }
        displayOrder: { type: integer }
        isCover: { type: boolean }

    SupportContact:
      type: object
      properties:
        id: { type: integer }
        name: { type: string }
        email: { type: string, format: email }
        message: { type: string }
        createdAt: { type: string, format: date-time }

    PageResponseSupportContact:
      type: object
      properties:
        items:
          type: array
          items: { $ref: '#/components/schemas/SupportContact' }
        page: { type: integer }
        hasNext: { type: boolean }

    ThriftStore:
      type: object
      properties:
        id: { type: string, format: uuid }
        name: { type: string }
        tagline: { type: string }
        coverImageUrl: { type: string }
        addressLine: { type: string }
        latitude: { type: number, format: double }
        longitude: { type: number, format: double }
        openingHours: { type: string }
        facebook: { type: string }
        instagram: { type: string }
        website: { type: string }
        phone: { type: string }
        whatsapp: { type: string }
        categories:
          type: array
          items: { type: string }
        rating: { type: number, format: double }
        reviewCount: { type: integer }
        distanceMeters: { type: number, format: double }
        walkTimeMinutes: { type: integer }
        neighborhood: { type: string }
        badgeLabel: { type: string }
        isFavorite: { type: boolean }
        description: { type: string }
        createdAt: { type: string, format: date-time }
        images:
          type: array
          items: { $ref: '#/components/schemas/StoreImage' }
    StoreSocialRequest:
      type: object
      description: Include explicit nulls to clear stored social links on update.
      properties:
        facebook:
          type: string
          nullable: true
          description: Send null to clear.
        instagram:
          type: string
          nullable: true
          description: Send null to clear.
        website:
          type: string
          nullable: true
          description: Send null to clear.
        whatsapp:
          type: string
          nullable: true
          description: Send null to clear.
    StoreCreateRequest:
      type: object
      required: [name, description, addressLine, phone, latitude, longitude]
      properties:
        name: { type: string, maxLength: 120 }
        description: { type: string, maxLength: 2000 }
        openingHours: { type: string, maxLength: 256 }
        addressLine: { type: string, maxLength: 512 }
        phone: { type: string, maxLength: 32 }
        email: { type: string, format: email, maxLength: 320 }
        neighborhood: { type: string, maxLength: 120 }
        tagline: { type: string, maxLength: 280 }
        latitude: { type: number, format: double }
        longitude: { type: number, format: double }
        categories:
          type: array
          maxItems: 10
          items: { type: string }
        social:
          $ref: '#/components/schemas/StoreSocialRequest'
    StoreUpdateRequest:
      type: object
      description: Social fields accept explicit nulls to clear existing values.
      properties:
        name: { type: string, maxLength: 120 }
        description: { type: string, maxLength: 2000 }
        openingHours: { type: string, maxLength: 256 }
        addressLine: { type: string, maxLength: 512 }
        phone: { type: string, maxLength: 32 }
        email: { type: string, format: email, maxLength: 320 }
        neighborhood: { type: string, maxLength: 120 }
        tagline: { type: string, maxLength: 280 }
        latitude: { type: number, format: double }
        longitude: { type: number, format: double }
        categories:
          type: array
          maxItems: 10
          items: { type: string }
        social:
          $ref: '#/components/schemas/StoreSocialRequest'
    FeaturedStore:
      type: object
      properties:
        id: { type: string, format: uuid }
        name: { type: string }
        coverImageUrl: { type: string }
    NearbyStore:
      type: object
      properties:
        id: { type: string, format: uuid }
        name: { type: string }
        description: { type: string }
        coverImageUrl: { type: string }
        addressLine: { type: string }
        latitude: { type: number, format: double }
        longitude: { type: number, format: double }
        neighborhood: { type: string }
        isFavorite: { type: boolean }
        categories:
          type: array
          items: { type: string }
        rating: { type: number, format: double }
        reviewCount: { type: integer }
        distanceMeters: { type: number, format: double }
        walkTimeMinutes: { type: integer }
    FavoriteStore:
      type: object
      properties:
        id: { type: string, format: uuid }
        name: { type: string }
        description: { type: string }
        coverImageUrl: { type: string }
        latitude: { type: number, format: double }
        longitude: { type: number, format: double }
        isFavorite: { type: boolean }
        distanceMeters: { type: number, format: double }
    AdminUser:
      type: object
      properties:
        id: { type: string, format: uuid }
        name: { type: string }
        email: { type: string, format: email }
        role: { type: string, enum: [USER, ADMIN] }
        createdAt: { type: string, format: date-time }
        photoUrl: { type: string, format: uri, nullable: true }
    AdminUserDetail:
      type: object
      properties:
        id: { type: string, format: uuid }
        name: { type: string }
        email: { type: string, format: email }
        role: { type: string, enum: [USER, ADMIN] }
        avatarUrl: { type: string, format: uri, nullable: true }
        bio: { type: string, nullable: true }
        notifyNewStores: { type: boolean }
        notifyPromos: { type: boolean }
        ownedThriftStore:
          $ref: '#/components/schemas/ThriftStore'
        createdAt: { type: string, format: date-time }
    GuideTop:
      type: object
      properties:
        id: { type: integer }
        title: { type: string }
        description: { type: string }
        imageUrl: { type: string }
        thriftStoreId: { type: string, format: uuid }
        thriftStoreName: { type: string }
        thriftStoreCoverImageUrl: { type: string }
        createdAt: { type: string, format: date-time }
        likeCount: { type: integer, format: int64 }
        commentCount: { type: integer, format: int64 }
        likedByMe: { type: boolean }
    GuideContentComment:
      type: object
      properties:
        id: { type: integer }
        body: { type: string }
        userId: { type: string, format: uuid }
        userDisplayName: { type: string }
        userPhotoUrl: { type: string }
        createdAt: { type: string, format: date-time }
        edited: { type: boolean }
    ContentComment:
      type: object
      properties:
        id: { type: integer }
        body: { type: string }
        userId: { type: string, format: uuid }
        userDisplayName: { type: string }
        userPhotoUrl: { type: string }
        contentId: { type: integer }
        contentTitle: { type: string }
        thriftStoreId: { type: string, format: uuid }
        thriftStoreName: { type: string }
        createdAt: { type: string, format: date-time }
        edited: { type: boolean }
    GuideContentCommentRequest:
      type: object
      required: [body]
      properties:
        body: { type: string, maxLength: 120 }
    ContentCreateRequest:
      type: object
      required: [title, description, storeId]
      properties:
        title: { type: string, maxLength: 160 }
        description: { type: string, maxLength: 2000 }
        storeId: { type: string, format: uuid }
    GuideContentUpdateRequest:
      type: object
      properties:
        title: { type: string, maxLength: 160 }
        description: { type: string, maxLength: 2000 }
        imageUrl: { type: string }
    HomeResponse:
      type: object
      properties:
        featured:
          type: array
          items: { $ref: '#/components/schemas/FeaturedStore' }
        nearby:
          type: array
          items: { $ref: '#/components/schemas/NearbyStore' }
        content:
          type: array
          items: { $ref: '#/components/schemas/GuideTop' }
    Category:
      type: object
      properties:
        id: { type: string }
        nameStringId: { type: string }
        imageResId: { type: string }
        createdAt: { type: string, format: date-time }
    CategoryUpsertRequest:
      type: object
      required: [id, nameStringId, imageResId]
      properties:
        id: { type: string }
        nameStringId: { type: string }
        imageResId: { type: string }
    PageResponseStoreCard:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/ThriftStore'
        page: { type: integer }
        hasNext: { type: boolean }
    PageResponseCategory:
      type: object
      properties:
        items:
          type: array
          items: { $ref: '#/components/schemas/Category' }
        page: { type: integer }
        hasNext: { type: boolean }
    DashboardStoreSummary:
      type: object
      properties:
        id: { type: string, format: uuid }
        name: { type: string }
        addressLine: { type: string }
        createdAt: { type: string, format: date-time }
    PageResponseDashboardStoreSummary:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/DashboardStoreSummary'
        page: { type: integer }
        hasNext: { type: boolean }
    NearbyPage:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/NearbyStore'
        page: { type: integer }
        hasNext: { type: boolean }

    PageResponseGuideTop:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/GuideTop'
        page: { type: integer }
        hasNext: { type: boolean }
    PageResponseGuideContentComment:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/GuideContentComment'
        page: { type: integer }
        hasNext: { type: boolean }
    PageResponseContentComment:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/ContentComment'
        page: { type: integer }
        hasNext: { type: boolean }

    AdminUser:
      type: object
      properties:
        id: { type: string, format: uuid }
        name: { type: string }
        email: { type: string, format: email }
        role: { type: string, enum: [USER, ADMIN] }
        createdAt: { type: string, format: date-time }

    PageResponseAdminUser:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/AdminUser'
        page: { type: integer }
        hasNext: { type: boolean }
